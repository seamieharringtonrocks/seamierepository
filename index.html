<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Gift Hunt 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { margin:0; padding:0; overflow:hidden; background:#000; font-family:Arial, sans-serif; touch-action: manipulation; }
  canvas { display:block; }
  #ui {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  #timer, #gifts, #levelName { position:absolute; font-size:24px; padding:10px; pointer-events:auto; }
  #timer { top:0; right:0; background:rgba(0,0,0,0.5); border-radius:0 0 0 15px; }
  #gifts { top:0; left:0; background:rgba(0,0,0,0.5); border-radius:0 0 15px 0; }
  }
  #levelName { bottom:0; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); padding:8px 20px; border-radius:15px 15px 0 0; font-size:28px; }
  #start, #gameOver {
    position: absolute; inset:0; background:rgba(0,0,0,0.85); color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; font-size:32px;
    pointer-events:auto;
  }
  button {
    margin-top:30px; padding:15px 40px; font-size:24px; background:#c00; color:white; border:none; border-radius:12px; cursor:pointer;
  }
  button:active { background:#900; }
  .locked { opacity:0.4; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
  <div id="timer"></div>
  <div id="gifts"></div>
  <div id="levelName"></div>
</div>

<div id="start">
  <h1>Christmas Gift Hunt 2025</h1>
  <p>Tap 20 gifts before time runs out!<br>Watch out for the Grinch!</p>
  <button onclick="showLevelSelect()">PLAY</button>
</div>

<div id="levelSelect" style="display:none;">
  <h1 style="margin:20px">Choose Level</h1>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;max-width:800px;margin:auto;">
    <!-- Levels will be injected here by JS -->
  </div>
  <button onclick="backToMenu()" style="margin-top:40px;">← Back</button>
</div>

<div id="gameOver" style="display:none;">
  <h1 id="result"></h1>
  <p id="scoreText"></p>
  <button onclick="shareResult()">Share Result</button>
  <button onclick="showLevelSelect()">Level Select</button>
  <button onclick="location.reload()">Play Again</button>
</div>

<audio id="music" loop></audio>

<script>
// ====================== LEVEL DATA ======================
const levels = [
  {name:"Cozy Living Room",          time:90,  grinches:0,   bg:"#2c3e50", music:"https://cdn.pixabay.com/download/audio/2022/11/08/audio_98d1679e8a.mp3"},      // Jingle Bells calm
  {name:"Snowy Village Night",       time:80,  grinches:0,   bg:"#0f1b2a", music:"https://cdn.pixabay.com/download/audio/2023/11/27/audio_2d7d69f5c9.mp3"},      // We Wish You calm
  {name:"Santa's Workshop",          time:70,  grinches:2,   bg:"#5d1a1a", music:"https://cdn.pixabay.com/download/audio/2022/11/08/audio_2d8f8c68d5.mp3"},      // Upbeat workshop
  {name:"Gifts:20, name:"Gingerbread House",         time:65,  grinches:3,   bg:"#8b4513", music:"https://cdn.pixabay.com/download/audio/2023/12/05/audio_2f1c0c06f9.mp3"},
  {name:"Australian Beach Christmas",time:60,  grinches:4,   bg:"#87CEEB", music:"https://cdn.pixabay.com/download/audio/2023/11/27/audio_2f8c0c06f0.mp3"},      // Summer jingle
  {name:"Enchanted Forest",           time:55,  grinches:8,   bg:"#0a2a0a", music:"https://cdn.pixabay.com/download/audio/2023/12/05/audio_5e8f8c68d5.mp3"},
  {name:"North Pole Blizzard",       time:50,  grinches:12,  bg:"#112233", music:"https://cdn.pixabay.com/download/audio/2023/11/27/audio_9d7d69f5c9.mp3"},
  {name:"Grinch's Mountain Lair",    time:45,  grinches:18,  bg:"#1a1a2e", music:"https://cdn.pixabay.com/download/audio/2023/12/05/audio_7f1c0c06f9.mp3"},
  {name:"Tropical Hawaiian Christmas",time:40,  grinches:25,  bg:"#006994", music:"https://cdn.pixabay.com/download/audio/2023/11/27/audio_1f8c0c06f0.mp3"},     // Mele Kalikimaka style
  {name:"Midnight Rooftop Rush",     time:35,  grinches:35,  bg:"#0d001a", music:"https://cdn.pixabay.com/download/audio/2023/12/05/audio_9f1c0c06f9.mp3"}      // Final epic
];

let c = document.getElementById("c");
let ctx = c.getContext("2d");
let music = document.getElementById("music");
let currentLevel = 0;
let giftsFound = 0;
let timeLeft = 0;
let timerInterval;
let objects = [];
let unlockedLevel = localStorage.getItem("xmasHunt2025") ? parseInt(localStorage.getItem("xmasHunt2025")) : 0;

// Resize canvas
function resize() {
  c.width = window.innerWidth;
  c.height = window.innerHeight;
}
window.onresize = resize;
resize();

// ====================== OBJECTS ======================
class Gift {
  constructor() {
    this.x = Math.random()*c.width;
    this.y = Math.random()*c.height;
    this.size = 30 + Math.random()*20;
  }
  draw() {
    ctx.fillStyle = "#c00";
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
    ctx.fillStyle = "#ff0";
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size/5);
  }
}

class Grinch {
  constructor() {
    this.x = Math.random()*c.width;
    this.y = Math.random()*c.height;
    this.size = 40 + Math.random()*30;
  }
  draw() {
    // Subtle bevel hint
    ctx.fillStyle = "#0a0";
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
    ctx.fillStyle = "#050";
    ctx.fillRect(this.x-this.size/2+4, this.y-this.size/2+4, this.size, this.size); // bevel
  }
}

// ====================== GAME LOOP ======================
function spawnObjects() {
  objects = [];
  for(let i=0; i<20; i++) objects.push(new Gift());
  for(let i=0; i<levels[currentLevel].grinches; i++) objects.push(new Grinch());
}

function draw() {
  ctx.fillStyle = levels[currentLevel].bg;
  ctx.fillRect(0,0,c.width,c.height);
  objects.forEach(o=>o.draw());

  document.getElementById("timer").textContent = `Time: ${Math.ceil(timeLeft)}s`;
  document.getElementById("gifts").textContent = `Gifts: ${giftsFound}/20`;
  document.getElementById("levelName").textContent = levels[currentLevel].name;
}

function gameLoop() {
  timeLeft -= 1/60;
  if(timeLeft <= 0) gameOver(false);
  draw();
  requestAnimationFrame(gameLoop);
}

// ====================== INPUT ======================
c.onclick = c.ontouchstart = (e)=>{
  e.preventDefault();
  let rect = c.getBoundingClientRect();
  let x = (e.touches?e.touches[0].clientX:e.clientX) - rect.left;
  let y = (e.touches?e.touches[0].clientY:e.clientY) - rect.top;

  for(let i=objects.length-1; i>=0; i--){
    let o = objects[i];
    if(Math.hypot(o.x-x, o.y-y) < o.size/2){
      if(o instanceof Gift){
        giftsFound++;
        objects.splice(i,1);
        if(giftsFound>=20) gameOver(true);
      } else { // Grinch
        giftsFound = 0;
        objects = objects.filter(obj=>obj instanceof Gift);
        // visual feedback
        ctx.fillStyle = "rgba(255,0,0,0.5)";
        ctx.fillRect(0,0,c.width,c.height);
      }
      break;
    }
  }
};

// ====================== START / END ======================
function startLevel(idx) {
  if(idx > unlockedLevel && idx <= 7) return; // normal progression
  if(idx >= 8 && new Date() < new Date("2025-12-20")) {
    alert("Levels 9 & 10 unlock on 20 December 2025!");
    return;
  }

  currentLevel = idx;
  giftsFound = 0;
  timeLeft = levels[idx].time;
  spawnObjects();

  music.src = levels[idx].music;
  music.play().catch(()=>{});

  document.getElementById("start").style.display="none";
  document.getElementById("levelSelect").style.display="none";
  document.getElementById("gameOver").style.display="none";
  document.getElementById("ui").style.pointerEvents="auto";

  clearInterval(timerInterval);
  gameLoop();
}

function gameOver(win) {
  clearInterval(timerInterval);
  music.pause();

  let score = win ? Math.floor(timeLeft * 5432) : 0;
  let text = win 
    ? `Level ${currentLevel+1} Complete!<br>${levels[currentLevel].name}`
    : "Time's up! The Grinch won this round!";

  document.getElementById("result").innerHTML = text;
  document.getElementById("scoreText").textContent = win ? `Score: ${score.toLocaleString()} points` :(` : "Better luck next time!";

  if(win && currentLevel+1 > unlockedLevel){
    unlockedLevel = currentLevel+1;
    localStorage.setItem("xmasHunt2025", unlockedLevel);
  }

  document.getElementById("gameOver").style.display="flex";
}

// ====================== LEVEL SELECT ======================
function showLevelSelect() {
  document.getElementById("start").style.display="none";
  let container = document.querySelector("#levelSelect div");
  container.innerHTML = "";
  levels.forEach((lvl,i)=>{
    let div = document.createElement("div");
    div.style.cssText = "background:linear-gradient(135deg,#c00,#f00);color:white;padding:20px;border-radius:15px;text-align:center;cursor:pointer;";
    if(i > unlockedLevel || (i>=8 && new Date() < new Date("2025-12-20"))) div.classList.add("locked");
    div.innerHTML = `<b>Level ${i+1}</b><br>${lvl.name}<br>${lvl.time}s`;
    div.onclick = ()=> startLevel(i);
    container.appendChild(div);
  });
  document.getElementById("levelSelect").style.display="flex";
}

function backToMenu() {
  document.getElementById("levelSelect").style.display="none";
  document.getElementById("start").style.display="flex";
}

// ====================== SHARE ======================
function shareResult() {
  let score = Math.floor(timeLeft * 5432);
  let text = `I just beat Level ${currentLevel+1} – ${levels[currentLevel].name} – in ${Math.ceil(levels[currentLevel].time - timeLeft)}s and scored ${score.toLocaleString()} points on Christmas Gift Hunt 2025! Can you beat me?`;
  if(navigator.share){
    navigator.share({title:"Christmas Gift Hunt 2025", text:text, url:location.href});
  } else {
    navigator.clipboard.writeText(text + " " + location.href);
    alert("Result copied to clipboard!");
  }
}

// Start screen
document.querySelector("#start button").onclick = showLevelSelect;
</script>
</body>
</html>