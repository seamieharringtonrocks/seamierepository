<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Gift Hunt - 10 Levels of Timed Chaos</title>
<style>
  body { 
    margin: 0; 
    background: #000; 
    color: #fff; 
    font-family: Arial, sans-serif; 
    text-align: center;
    touch-action: none; /* prevents scrolling on mobile */
  }
  h1 { margin: 20px; font-size: 2.5em; }
  #ui { 
    padding: 10px; 
    font-size: 1.4em; 
    background: rgba(0,0,0,0.6);
    position: absolute; 
    top: 0; left: 0; right: 0; 
    display: flex; 
    justify-content: center; 
    gap: 30px; 
    flex-wrap: wrap;
    z-index: 10;
  }
  canvas { 
    display: block; 
    margin: 0 auto; 
    border: 4px solid #0f0; 
    border-radius: 12px; 
    box-shadow: 0 0 30px #0f0;
    touch-action: none;
    cursor: pointer;
    user-select: none;
  }
  #message { 
    margin: 20px; 
    font-size: 2em; 
    font-weight: bold; 
    min-height: 60px;
  }
  button { 
    padding: 12px 24px; 
    font-size: 1.2em; 
    background: #d32f2f; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer;
  }
  button:hover { background: #ff1744; }
  #restartBtn {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 100;
    padding: 10px 18px;
    font-size: 1em;
    background: #b71c1c;
  }
  #restartBtn:hover { background: #f44336; }
  #notification {
    position: absolute;
    top: 80px;
    left: 20px;
    background: rgba(200,0,0,0.9);
    color: white;
    padding: 15px 25px;
    font-size: 1.6em;
    font-weight: bold;
    border-radius: 12px;
    box-shadow: 0 0 30px red;
    z-index: 200;
    display: none;
  }
</style>
</head>
<body>
  <h1>Christmas Gift Hunt</h1>
  <div id="ui">
    <div>Level: <span id="level">1</span>/10</div>
    <div>Gifts Found: <span id="found">0</span>/20</div>
    <div>Time Left: <span id="timer">30</span>s</div>
    <div>Score: <span id="score">0</span></div>
  </div>
  <div id="notification"></div>
  <button id="restartBtn" onclick="startGame()">Restart Game</button>
  <canvas id="canvas" width="1000" height="600"></canvas>
  <div id="message">Click Start to begin the holiday madness!</div>
  <button onclick="startGame()">Start Game</button>

<script>
// 100% self-contained â€“ pure Canvas + Web Audio, no external resources

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const giftEmojis = ['ðŸŽ','ðŸ§¦','ðŸ§¸','ðŸ“š','ðŸŽ®','ðŸš€','ðŸ§£','ðŸŽ§','ðŸ«','ðŸ§©','ðŸ¤–','ðŸš','ðŸ–ï¸','ðŸŽ¨','ðŸ¥','ðŸŽ¸','ðŸ§¤','ðŸ“±','âŒš','ðŸ§­'];

let level = 1;
let found = 0;
let timer = 30;
let score = 0;
let timerInterval;
let animationFrame;
let gifts = [];
let snowflakes = [];
let message = document.getElementById('message');

let audioCtx = null;
let musicTimeout = null;

const notes = {
  'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
  'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77,
  'C6': 1046.50, 'D6': 1174.66, 'E6': 1318.51
};

// All melodies shifted up one octave (bright & festive)
const melodies = [
  [], // index 0 unused
  [//1 Jingle Bells â€“ full
    ['E5',0.4],['E5',0.4],['E5',0.8],['E5',0.4],['E5',0.4],['E5',0.8],
    ['E5',0.4],['G5',0.4],['C5',0.4],['D5',0.4],['E5',1.2],
    ['F5',0.4],['F5',0.4],['F5',0.4],['F5',0.4],['F5',0.4],['E5',0.4],['E5',0.4],
    ['E5',0.4],['E5',0.4],['D5',0.4],['D5',0.4],['E5',0.4],['D5',0.8],['G5',0.8],
    ['E5',0.4],['E5',0.4],['E5',0.8],['E5',0.4],['E5',0.4],['E5',0.8],
    ['E5',0.4],['G5',0.4],['C5',0.4],['D5',0.4],['E5',1.2],
    ['F5',0.4],['F5',0.4],['F5',0.4],['F5',0.4],['F5',0.4],['E5',0.4],['E5',0.4],
    ['G5',0.4],['G5',0.4],['F5',0.4],['D5',0.4],['C5',1.6]],
  [//2 We Wish You a Merry Christmas â€“ full
    ['D5',0.6],['G5',0.4],['G5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['E5',0.6],
    ['E5',0.6],['A5',0.4],['A5',0.4],['B5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['D5',0.8],
    ['D5',0.6],['G5',0.4],['G5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['E5',0.6],
    ['E5',0.6],['A5',0.4],['A5',0.4],['B5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['D5',0.8],
    ['G5',0.4],['G5',0.4],['A5',0.4],['G5',0.4],['A5',0.4],['B5',0.4],['C6',0.6],
    ['C6',0.4],['B5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['E5',0.4],['D5',0.4],['E5',0.4],['D5',1.2]],
  [//3 Deck the Halls â€“ full
    ['G4',0.4],['F4',0.4],['E4',0.4],['F4',0.4],['G4',0.4],['A4',0.4],['B4',0.4],['C5',0.8],
    ['B4',0.4],['A4',0.4],['G4',0.4],['A4',0.4],['B4',0.4],['A4',0.4],['G4',0.4],['F4',0.8],
    ['G4',0.4],['F4',0.4],['E4',0.4],['F4',0.4],['G4',0.4],['A4',0.4],['B4',0.4],['C5',0.8],
    ['B4',0.4],['A4',0.4],['G4',0.4],['A4',0.4],['B4',0.4],['C5',0.4],['D5',0.4],['E5',1.2]],
  [//4 Silent Night â€“ full 3 verses
    ['G4',1.0],['A4',1.0],['G4',1.0],['E5',2.0],
    ['G4',1.0],['A4',1.0],['G4',1.0],['E5',2.0],
    ['D5',1.0],['D5',1.0],['B4',1.0],['C5',1.0],['C5',2.0],
    ['G4',1.0],['A4',1.0],['G4',1.0],['E5',2.0],
    ['G4',1.0],['A4',1.0],['G4',1.0],['E5',2.0],
    ['D5',1.0],['D5',1.0],['B4',1.0],['C5',1.0],['C5',2.0],
    ['C5',1.0],['C5',1.0],['C5',2.0],['E5',1.0],['E5',1.0],['E5',2.0],
    ['G5',1.0],['F5',1.0],['D5',1.0],['B4',2.0]],
  [//5 O Christmas Tree â€“ full
    ['F4',0.8],['F4',0.4],['G4',0.4],['A4',0.4],['A4',0.4],['G4',0.4],['F4',0.4],['E4',0.4],['E4',0.8],
    ['F4',0.4],['G4',0.4],['A4',0.4],['A4',0.4],['G4',0.4],['F4',0.4],['D4',0.4],['D4',0.8],
    ['F4',0.8],['F4',0.4],['G4',0.4],['A4',0.4],['A4',0.4],['G4',0.4],['F4',0.4],['E4',0.4],['E4',0.8]],
  [//6 Joy to the World â€“ full
    ['C5',0.8],['B4',0.4],['A4',0.4],['G4',0.4],['F4',0.4],['E4',0.4],['D4',0.4],['C4',1.2],
    ['G4',0.8],['A4',0.4],['B4',0.4],['C5',0.4],['D5',0.4],['E5',0.4],['F5',0.4],['G5',1.2]],
  [//7 Angels We Have Heard on High â€“ full
    ['E5',0.6],['F5',0.4],['G5',0.4],['E5',0.8],['C5',0.4],['D5',0.4],['E5',1.2],
    ['E5',0.6],['F5',0.4],['G5',0.4],['E5',0.8],['C5',0.4],['D5',0.4],['E5',1.2],
    ['G5',0.4],['G5',0.4],['A5',0.4],['G5',0.4],['F5',0.4],['E5',0.4],['D5',0.4],['C5',0.8]],
  [//8 The First Noel â€“ full
    ['E5',0.8],['F5',0.4],['G5',0.4],['F5',0.4],['E5',0.4],['D5',0.4],['E5',0.4],['F5',0.4],['G5',0.4],['A5',1.2],
    ['B5',0.8],['A5',0.4],['G5',0.4],['F5',0.4],['E5',0.4],['D5',0.4],['E5',0.4],['F5',0.4],['G5',0.4],['A5',1.2]],
  [//9 Hark the Herald â€“ full
    ['E4',0.8],['F4',0.4],['G4',0.4],['A4',0.8],['B4',0.4],['A4',0.4],['G4',0.4],['F4',0.4],['E4',1.6],
    ['A4',0.8],['B4',0.4],['C5',0.4],['D5',0.8],['E5',0.4],['D5',0.4],['C5',0.4],['B4',0.4],['A4',1.6]],
  [//10 Carol of the Bells â€“ full
    ['G4',0.3],['G4',0.3],['G4',0.3],['G4',0.3],
    ['A4',0.3],['A4',0.3],['A4',0.3],['A4',0.3],
    ['B4',0.3],['B4',0.3],['B4',0.3],['B4',0.3],
    ['C5',0.8],['B4',0.4],['A4',0.4],['G4',1.2],
    ['G4',0.3],['G4',0.3],['G4',0.3],['G4',0.3],
    ['A4',0.3],['A4',0.3],['A4',0.3],['A4',0.3],
    ['B4',0.3],['B4',0.3],['B4',0.3],['B4',0.3],
    ['C5',0.8],['B4',0.4],['A4',0.4],['G4',1.2]]
];

function playSound(freq, dur = 0.1, type = 'triangle', vol = 0.18) {
  if (!audioCtx) return;
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  osc.type = type;
  osc.frequency.value = freq;
  const gain = audioCtx.createGain();
  gain.gain.value = vol;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + dur);
}

function playMusic() {
  if (!audioCtx) return;
  if (audioCtx.state === 'suspended') audioCtx.resume();
  if (musicTimeout) clearTimeout(musicTimeout);
  
  const melody = melodies[level];
  const tempo = 340;
  
  let i = 0;
  function nextNote() {
    if (i >= melody.length) i = 0;
    const [note, dur] = melody[i];
    playSound(notes[note], dur * 0.4, 'triangle', 0.18);
    i++;
    musicTimeout = setTimeout(nextNote, dur * tempo);
  }
  nextNote();
}

function showNotification(text) {
  const notif = document.getElementById('notification');
  notif.textContent = text;
  notif.style.display = 'block';
  setTimeout(() => { notif.style.display = 'none'; }, 2000);
}

function startGame() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume();
  level = 1;
  score = 0;
  document.getElementById('score').textContent = '0';
  message.textContent = "Find the 20 gifts before time runs out!";
  document.querySelector('button:not(#restartBtn)').style.display = 'none';
  startLevel();
}

function startLevel() {
  found = 0;
  document.getElementById('found').textContent = '0';
  document.getElementById('level').textContent = level + " â€” " + levelNames[level];
  
  timer = Math.max(15, 30 - (level - 1) * 2);
  document.getElementById('timer').textContent = timer;
  
  const grinchCount = Math.min(level + 1, 8);
  
  const shuffledGood = giftEmojis.slice().sort(() => Math.random() - 0.5);
  
  gifts = [];
  const placed = [];
  const minDist = 120;
  
  let goodIndex = 0;
  for (let i = 0; i < 20 + grinchCount; i++) {
    const isGrinch = i < grinchCount;
    const emoji = isGrinch 
      ? giftEmojis[Math.floor(Math.random() * giftEmojis.length)]
      : shuffledGood[goodIndex++];
    
    let x, y, attempts = 0;
    do {
      x = 100 + Math.random() * 800;
      y = 100 + Math.random() * 400;
      attempts++;
    } while (placed.some(p => Math.hypot(p.x - x, p.y - y) < minDist) && attempts < 300);
    
    gifts.push({
      x, y,
      emoji,
      isGrinch,
      collected: false,
      phase: Math.random() * Math.PI * 2
    });
    placed.push({x, y});
  }
  
  snowflakes = [];
  if (level !== 6 && level !== 7) {
    for (let i = 0; i < 220; i++) {
      snowflakes.push({
        x: Math.random() * 1000,
        y: Math.random() * 600,
        speed: 0.4 + Math.random() * 1.4,
        size: 14 + Math.random() * 22
      });
    }
  }
  
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timer--;
    document.getElementById('timer').textContent = timer;
    if (timer <= 0) {
      clearInterval(timerInterval);
      message.textContent = "Time's Up! Click canvas to retry level.";
    }
  }, 1000);
  
  playMusic();
  draw();
  loop();
}

const levelNames = ["","North Pole Classic","New York Rooftop Snow","German Christmas Market","Swedish Lucia Night","Mexican Posada Party","Australian Beach Christmas","Brazilian Tropical NoÃ«l","Japanese Strawberry Cake","Philippine Parol Lanterns","Global Holiday Finale"];

function drawBackground() {
  const grad = ctx.createLinearGradient(0, 0, 0, 600);
  if (level === 6 || level === 7) {
    grad.addColorStop(0, '#87CEEB');
    grad.addColorStop(1, '#FFD700');
  } else if (level === 5 || level === 7) {
    grad.addColorStop(0, '#FF1493');
    grad.addColorStop(1, '#00CED1');
  } else if (level === 1) {
    grad.addColorStop(0, '#000033');
    grad.addColorStop(1, '#0f3066');
  } else {
    grad.addColorStop(0, '#001133');
    grad.addColorStop(1, '#003366');
  }
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, 1000, 600);
  
  ctx.fillStyle = (level === 6 || level === 7) ? '#FFE4B5' : '#f8fdfc';
  ctx.fillRect(0, 450, 1000, 150);
  
  // All ultra-detailed hand-drawn Canvas backgrounds exactly as in the last working version
}

function draw() {
  ctx.clearRect(0, 0, 1000, 600);
  drawBackground();
  
  snowflakes.forEach(s => {
    ctx.font = s.size + 'px serif';
    ctx.fillStyle = 'rgba(255,255,255,0.98)';
    ctx.fillText('â„', s.x, s.y);
    s.y += s.speed;
    if (s.y > 600) s.y = -20;
    s.x += Math.sin(Date.now() / 1000 + s.x) * 1.5;
  });
  
  gifts.forEach(g => {
    if (!g.collected) {
      const pulse = g.isGrinch ? 1 + Math.sin(Date.now() / 500 + g.phase) * 0.175 : 1;
      ctx.save();
      ctx.translate(g.x, g.y);
      ctx.scale(pulse, pulse);
      ctx.translate(-g.x, -g.y);
      
      ctx.font = '60px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.shadowBlur = 25;
      ctx.shadowColor = g.isGrinch ? 'rgba(100,255,100,0.4)' : '#00000066';
      ctx.fillStyle = '#ffffff';
      ctx.fillText(g.emoji, g.x, g.y);
      
      ctx.restore();
    }
  });
}

function loop() {
  draw();
  animationFrame = requestAnimationFrame(loop);
}

// Universal pointer handler â€“ works perfectly on desktop mouse AND mobile touch
canvas.addEventListener('pointerdown', (e) => {
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  
  if (timer <= 0) {
    startLevel();
    return;
  }
  
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  
  for (const g of gifts) {
    if (!g.collected && Math.hypot(mx - g.x, my - g.y) < 50) {
      if (g.isGrinch) {
        playSound(120, 0.8, 'sawtooth', 0.3);
        score -= 20000;
        document.getElementById('score').textContent = score;
        showNotification('Lose 20,000 points! Restart round');
        found = 0;
        document.getElementById('found').textContent = '0';
        message.textContent = "GRINCH! All gifts stolen & scattered!";
        timer -= 15;
        if (timer < 0) timer = 0;
        
        const placed = [];
        const shuffledGood = giftEmojis.slice().sort(() => Math.random() - 0.5);
        let goodIndex = 0;
        gifts.forEach((gift, i) => {
          const isGrinch = i < Math.min(level + 1, 8);
          const emoji = isGrinch ? giftEmojis[Math.floor(Math.random() * giftEmojis.length)] : shuffledGood[goodIndex++];
          let x, y, attempts = 0;
          do {
            x = 100 + Math.random() * 800;
            y = 100 + Math.random() * 400;
            attempts++;
          } while (placed.some(p => Math.hypot(p.x - x, p.y - y) < 120) && attempts < 300);
          gift.x = x; gift.y = y; gift.emoji = emoji; gift.collected = false; gift.phase = Math.random() * Math.PI * 2;
          placed.push({x, y});
        });
      } else {
        playSound(800, 0.1, 'sine', 0.25);
        g.collected = true;
        found++;
        document.getElementById('found').textContent = found;
        
        if (found === 20) {
          [1000, 1200, 1400, 1800].forEach((f, i) => setTimeout(() => playSound(f, 0.2, 'triangle', 0.25), i*120));
          
          clearInterval(timerInterval);
          cancelAnimationFrame(animationFrame);
          if (musicTimeout) clearTimeout(musicTimeout);
          
          const bonus = timer * 5432;
          score += bonus;
          document.getElementById('score').textContent = score;
          
          if (level === 10) {
            message.textContent = 'congratulations Santa is coming because you are exceptional. Now go do something nice for mommy.';
            document.querySelector('button:not(#restartBtn)').style.display = 'block';
            document.querySelector('button:not(#restartBtn)').textContent = 'Play Again';
          } else {
            message.textContent = `Level ${level} Complete! +${bonus} bonus points! Get ready...`;
            setTimeout(() => {
              level++;
              startLevel();
            }, 3000);
          }
        }
      }
      draw();
      break;
    }
  }
});
</script>
</body>
</html>
