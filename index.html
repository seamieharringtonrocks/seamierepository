<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Gift Hunt 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body { margin: 0; overflow: hidden; background: #000; font-family: Arial, sans-serif; touch-action: manipulation; }
canvas { display: block; }
#ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
#timer, #gifts, #levelName { position: absolute; font-size: 24px; padding: 10px; pointer-events: auto; background: rgba(0,0,0,0.5); border-radius: 10px; }
#timer { top: 10px; right: 10px; }
#gifts { top: 10px; left: 10px; }
#levelName { bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); padding: 8px 20px; border-radius: 15px 15px 0 0; font-size: 28px; }
#start, #gameOver, #levelSelect { position: absolute; inset: 0; background: rgba(0,0,0,0.85); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 32px; pointer-events: auto; }
button { margin-top: 30px; padding: 15px 40px; font-size: 24px; background: #c00; color: white; border: none; border-radius: 12px; cursor: pointer; }
button:active { background: #900; }
.card { background: linear-gradient(135deg, #c00, #f00); color: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; margin: 10px; min-width: 150px; }
.card.locked { opacity: 0.4; cursor: not-allowed; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
  <div id="timer"></div>
  <div id="gifts"></div>
  <div id="levelName"></div>
</div>

<div id="start">
  <h1>Christmas Gift Hunt 2025</h1>
  <p>Tap 20 gifts before time runs out!<br>Watch for the Grinch traps!</p>
  <button id="playBtn">PLAY</button>
</div>

<div id="levelSelect" style="display: none;">
  <h1 style="margin: 20px">Choose Level</h1>
  <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; max-width: 900px; margin: auto;"></div>
  <button onclick="backToMenu()">‚Üê Back</button>
</div>

<div id="gameOver" style="display: none;">
  <h1 id="result"></h1>
  <p id="scoreText"></p>
  <button onclick="shareResult()">Share Result</button>
  <button onclick="showLevelSelect()">Level Select</button>
  <button onclick="location.reload()">Play Again</button>
</div>

<audio id="music" loop></audio>

<script>
const levels = [
  { name: "Cozy Living Room", time: 45, grinches: 0, bg: "#8B4513", music: "https://cdn.pixabay.com/download/audio/2022/11/08/audio_98d1679e8a.mp3" },
  { name: "Snowy Village Night", time: 42, grinches: 0, bg: "#4682B4", music: "https://cdn.pixabay.com/download/audio/2023/11/27/audio_2d7d69f5c9.mp3" },
  { name: "Santa's Workshop", time: 40, grinches: 3, bg: "#CD853F", music: "https://cdn.pixabay.com/download/audio/2022/11/08/audio_2d8f8c68d5.mp3" },
  { name: "Gingerbread House", time: 38, grinches: 5, bg: "#D2691E", music: "https://cdn.pixabay.com/download/audio/2023/12/05/audio_2f1c0c06f9.mp3" },
  { name: "Australian Beach Xmas", time: 36, grinches: 7, bg: "#87CEEB", music: "https://cdn.pixabay.com/download/audio/2023/11/27/audio_2f8c0c06f0.mp3" },
  { name: "Enchanted Forest", time: 34, grinches: 10, bg: "#228B22", music: "https://cdn.pixabay.com/download/audio/2023/12/05/audio_5e8f8c68d5.mp3" },
  { name: "North Pole Blizzard", time: 32, grinches: 14, bg: "#4169E1", music: "https://cdn.pixabay.com/download/audio/2023/11/27/audio_9d7d69f5c9.mp3" },
  { name: "Grinch's Lair", time: 30, grinches: 20, bg: "#2F4F4F", music: "https://cdn.pixabay.com/download/audio/2023/12/05/audio_7f1c0c06f9.mp3" },
  { name: "Hawaiian Christmas", time: 28, grinches: 28, bg: "#20B2AA", music: "https://cdn.pixabay.com/download/audio/2023/11/27/audio_1f8c0c06f0.mp3" },
  { name: "Rooftop Rush", time: 25, grinches: 40, bg: "#191970", music: "https://cdn.pixabay.com/download/audio/2023/12/05/audio_9f1c0c06f9.mp3" }
];

let canvas = document.getElementById("c");
let ctx = canvas.getContext("2d");
let music = document.getElementById("music");
let currentLevel = 0;
let giftsFound = 0;
let timeLeft = 0;
let objects = [];
let unlockedLevel = localStorage.getItem("xmasHunt2025") ? parseInt(localStorage.getItem("xmasHunt2025")) : 0;
let gameRunning = false;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

class Gift {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = 40 + Math.random() * 20;
  }
  draw() {
    ctx.save();
    ctx.globalAlpha = 0.6; // Subtle transparency for "hiding"
    ctx.fillStyle = "#DC143C"; // Red box
    ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
    ctx.fillStyle = "#FFD700"; // Gold ribbon
    ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size / 6);
    ctx.restore();
  }
}

class Grinch {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = 50 + Math.random() * 30;
  }
  draw() {
    ctx.save();
    ctx.globalAlpha = 0.4; // Very subtle
    ctx.fillStyle = "#006400"; // Dark green
    ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
    // Subtle bevel hint on edges
    ctx.fillStyle = "#004d00";
    ctx.fillRect(this.x - this.size / 2 + 3, this.y - this.size / 2 + 3, this.size - 6, this.size - 6);
    ctx.restore();
  }
}

function spawnObjects() {
  objects = [];
  for (let i = 0; i < 20; i++) objects.push(new Gift());
  for (let i = 0; i < levels[currentLevel].grinches; i++) objects.push(new Grinch());
}

function draw() {
  // Background
  ctx.fillStyle = levels[currentLevel].bg;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  // Objects
  objects.forEach(o => o.draw());
  // UI
  document.getElementById("timer").textContent = `Time: ${Math.ceil(timeLeft)}s`;
  document.getElementById("gifts").textContent = `Gifts: ${giftsFound}/20`;
  document.getElementById("levelName").textContent = levels[currentLevel].name;
}

function gameLoop() {
  if (!gameRunning) return;
  timeLeft -= 1 / 60;
  if (timeLeft <= 0) {
    gameOver(false);
    return;
  }
  draw();
  requestAnimationFrame(gameLoop);
}

canvas.addEventListener('click', (e) => {
  if (!gameRunning) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  for (let i = objects.length - 1; i >= 0; i--) {
    const obj = objects[i];
    if (Math.hypot(obj.x - x, obj.y - y) < obj.size / 2) {
      if (obj instanceof Gift) {
        giftsFound++;
        objects.splice(i, 1);
        if (giftsFound >= 20) gameOver(true);
      } else { // Grinch trap
        giftsFound = 0;
        spawnObjects(); // Respawn gifts in new spots - lose time!
        // Flash screen red
        ctx.fillStyle = "rgba(255,0,0,0.5)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      break;
    }
  }
});
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const mouseEvent = new MouseEvent('click', {
    clientX: touch.clientX,
    clientY: touch.clientY
  });
  canvas.dispatchEvent(mouseEvent);
});

function startLevel(idx) {
  currentLevel = idx;
  giftsFound = 0;
  timeLeft = levels[idx].time;
  gameRunning = true;
  spawnObjects();
  music.src = levels[idx].music;
  music.play().catch(() => {});

  document.getElementById("start").style.display = "none";
  document.getElementById("levelSelect").style.display = "none";
  document.getElementById("gameOver").style.display = "none";
  document.getElementById("ui").style.pointerEvents = "auto";

  gameLoop();
}

function gameOver(win) {
  gameRunning = false;
  music.pause();
  let score = win ? Math.floor(timeLeft * 5432) : 0;
  let text = win ? `Level ${currentLevel + 1} Complete!<br>${levels[currentLevel].name}` : "Time's up! Grinch wins!";
  document.getElementById("result").innerHTML = text;
  document.getElementById("scoreText").textContent = win ? `Score: ${score.toLocaleString()} points` : "Better luck next time!";

  if (win && currentLevel + 1 > unlockedLevel) {
    unlockedLevel = currentLevel + 1;
    localStorage.setItem("xmasHunt2025", unlockedLevel);
  }

  document.getElementById("gameOver").style.display = "flex";
}

function showLevelSelect() {
  document.getElementById("start").style.display = "none";
  const container = document.querySelector("#levelSelect .grid");
  container.innerHTML = "";
  levels.forEach((lvl, i) => {
    const div = document.createElement("div");
    div.className = "card" + (i > unlockedLevel ? " locked" : "");
    div.innerHTML = `<b>Level ${i + 1}</b><br>${lvl.name}<br>${lvl.time}s`;
    if (i <= unlockedLevel) div.onclick = () => startLevel(i);
    container.appendChild(div);
  });
  document.getElementById("levelSelect").style.display = "flex";
}

function backToMenu() {
  document.getElementById("levelSelect").style.display = "none";
  document.getElementById("start").style.display = "flex";
}

function shareResult() {
  const score = Math.floor(timeLeft * 5432);
  const text = `I beat Level ${currentLevel + 1} in ${Math.ceil(levels[currentLevel].time - timeLeft)}s with ${score.toLocaleString()} points on Christmas Gift Hunt 2025!`;
  if (navigator.share) {
    navigator.share({ title: "Christmas Gift Hunt", text, url: location.href });
  } else {
    navigator.clipboard.writeText(text + " " + location.href);
    alert("Copied to clipboard!");
  }
}

// Init
document.getElementById("playBtn").onclick = showLevelSelect;
</script>
</body>
</html>
